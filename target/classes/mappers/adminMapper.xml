<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="admin">

<select id="selectAdminList" resultType="userinfo">
	select id, password, name, nickname, to_char(birth,'yyyy-mm-dd') birth, email, tel, addr, auth, profile, secure, secure_ans,
		 to_char(regdate,'yyyy-mm-dd hh24:mi:ss') regdate, to_char(updatedate,'yyyy-mm-dd hh24:mi:ss') updatedate,
		 (select count(*) from tbl_boards where id = userinfos.id) myBoards, (select count(*) from tbl_replies where id = userinfos.id) replyCount
		from userinfos 
		where auth = 2
		order by regdate desc
</select>

<select id="selectMemberList" resultType="userinfo">
	select userinfos.id, password, name, nickname, to_char(birth,'yyyy-mm-dd') birth, email, tel, addr, auth, profile, secure, secure_ans,
		 to_char(regdate,'yyyy-mm-dd hh24:mi:ss') regdate, to_char(updatedate,'yyyy-mm-dd hh24:mi:ss') updatedate,
		 (select count(*) from tbl_boards where id = userinfos.id) myBoards, (select count(*) from tbl_replies where id = userinfos.id) replyCount,state
		from userinfos INNER JOIN userstate on userinfos.id = userstate.ID
		where auth != 2
		
		<include refid="search"/>
		
		order by regdate desc
</select>

<select id="selectMemberCount" resultType="int">
	select count(*) from userinfos where auth != 2
	<include refid="search"/>
</select>

<update id="upgrade">
	update userinfos set auth= auth + 2 where id = #{id}
</update>

<update id="downgrade">
	update userinfos set auth= auth - 2 where id = #{id}
</update>

	<sql id="search">
	<if test="searchType != null">
		<if test="searchType == 'n'.toString()">
			and name like '%'||#{keyword}||'%'
		</if>
		<if test="searchType == 't'.toString()">
			and id like '%'||#{keyword}||'%'
		</if>
	</if>
	</sql>

</mapper>